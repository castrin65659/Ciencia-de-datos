---
title: "Actividad 1-Análisis exploratorio rotación de personal"
author: "Camilo Castro - David Alejandro Rivera Correa"
date: "2022-08-02"
output:
  html_document: default
  pdf_document: default
---

## Introducción

El siguiente documento tiene como finalidad desarrollar un ejercicio básico de análisis exploratorio de datos abordando la tematica de rotación de personal en una organización, tomando como base el dataset "rotación.xlsx" que contiene información de los trabajadores que han rotado (han realizado un retiro voluntario de la compañia) y de aquellos que aun se mantienen en la organización.

Para la ejecución de este ejercicio se plantearán hipotesis iniciales respecto a las razones que podrian generar la rotación que involucren o relacionen tres variables cuantitivas y tres variables cualitativas del set de datos. A partir de esto se llevará a cabo un análisis descriptivo univariado y bivariado que permita identificar algunos patrones que permitan generar conclusiones iniciales respecto las hipotesis planteadas y estrategias potenciales respecto a los hallazgos preliminares. 


## Preparación del entorno

### Carga e instalación de paquetes 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r message=FALSE, warning=FALSE, paged.print=FALSE}

library(readxl)#paquetes para lectura de Excel
library(tidyverse) #Conjunto de paquetes diseñados para ciencia de datos
library(ggplot2) # paquete de visualización
library(ggpubr)#paquete para aumentar personalización de ggplot
library(cdparcoord)#paquete para generación de diagrma de categorias paralelas
library(GGally)


```


### Carga de la base de datos

```{r}

library(readxl)
datos=read_excel("Datos_Rotacion.xlsx")
glimpse(datos)

```
El set de datos cuenta con un total de 24 columnas y 1470 registros, en la sección siguiente se seleccionaran 3 variables cualitativas y cuantitativas para llevar a cabo el análisis. 


## 1.seleccion de variables 

La decisión de retiro voluntario de una empresa por parte de un trabajador esta ligada a una decisión relacionada a los incentivos para quedarse en su empresa y no decidir tomar un trabajo en otra o optar por actividades alternativas. Parte de los incentivos y desincentivos de permanecer tambien se asocian a costos de oportunidad ligadas a condiciones propias del trabajador, por ejemplo un empleado joven que ya ha superado la barrera de adquirir experiencia laboral eventualmente tendrá menor aversión al riesgo de cambiar de empresa en especial si en el contexto del mercado laboral en el cual se desenvuelve las empresas tienen preferencia por trabajadores jovenes y las condiciones laborales no satisfacen su aspiración, paralelamente una persona de mayor edad y con poca experiencia y baja cualificación tendra menos incentivos de cambiar dado que su tiempo cesante podria ser amplio y esto representa un alto impacto en su calidad de vida por lo tanto aunque las condiciones no fueran las mejoras se esperaria un menor nivel de rotación en este grupo.

En concordancia a lo anterior y teniendo en cuenta el set de datos principal se esperaria que una edad menor, una experiencia media y distancias mayores del lugar de trabajo se relacionen a mayor rotación en especial si el individuo esta en puestos operativos y no esta satisfecho con el clima organizacional y tiene carga laboral extra.  

Considerando lo anterior se seleccionan las siguientes variables:

Variable de estudio:
Rotación

Cuantitativas: 

Edad
Distancia_Casa
Años_Experiencia


Cualitativas:

Satisfacción_Ambiental
Cargo
Horas_Extra

Para dar inicio al análisis se genera un set de datos depurado con las variables a analizar:

```{r}

#Inicialmente se transforma Satisfacción Ambiental a Factor dado que es una variable
# cualitativa ordinal que mide nivel de satisfaccion

datos$Satisfacción_Ambiental<- as.factor(datos$Satisfacción_Ambiental) 


# Se genera un set de datos unicamente con las variables a analizar y se le asigna el nombre 
# datos_grupo

datos_grupo<- datos %>% 
    select(Rotación,Edad,Distancia_Casa,Años_Experiencia,Satisfacción_Ambiental,Cargo,Horas_Extra)

glimpse(datos_grupo)


```

### 2.1 Análisis Univariado de variables cuantitativas:

Se seleccionan las variables edad y años de experiencia las cuales están ligadas a la juventud de un individuo, consideramos que una de las causas de rotación se da principalmente en las personas más jóvenes quienes tienen menos obligaciones y menor estabilidad en múltiples aspectos, además incluimos la variable distancia la cual puede ser crucial en la permanencia en un empleo dado que representa un costo implicito de laboral (se esperaria que una distancia mayor del lugar de trabajo represente mayores costos de transporte para el trabajador).

Como primer ejercicio se revisan los estadísticos basicos de las variables cuantitativas:

```{r}

summary <- datos_grupo %>% 
    select(Edad,Distancia_Casa,Años_Experiencia) %>%
    summary(datos_grupo)

summary

```
A partir de estos estadisticos básicos es posible observar que la edad promedio de los trabajadores es 36.92 años mostrando de esta forma una cercania a la mediana la cual es de 36 la cual nos comunica que el 50% de los trabajadores tiene como máximo 36 años, asi mismo se muestra que la edad máxima entre los mismos es de 60 años.  

Por otro la distancia respecto a lugar de trabajo evidencia que el 50% de los trabajadores vive como máximo a 7 kilometros del lugar de trabajo mientras que el 50% vive en zonas con distancias superiores, para el caso de esta variable la media es mayor a la mediana lo cual indica que la distribución de distancias presenta un sesgo a la derecha lo cual indica que la cola derecha de esta distribución es pesada y por lo tanto el 50% restante de los trabajadores tiene una dispersión importante respecto a las distancias del trabajo. 

Finalmente los estadisticos basicos de los años de experiencia muestran que el 25% de los trabajores tienen como máximo 6 años de experiencia y que el 50% tienen como máximo 10 años de experiencia mientras que el 50% restante presenta experiencias superiores a los 10 años, es de resaltar que la empresa en sus extremos desde lo minimo tambien cuenta con trabajadores sin experiencia y en su vertiente máxima cuenta con trabajadores que tienen hasta 40 años de experiencia laboral.  

Para ver con más claridad las distribuciones que comunican los estadisticos, a continuación se muestra un histograma y un diagrama de caja para cada variable: 

```{r echo=FALSE}

require(ggplot2)
require(ggpubr)
g1=ggplot(datos,aes(x=Edad))+geom_histogram()+theme_bw()
g1_1=ggplot(datos,aes(x=Edad))+geom_boxplot()+theme_bw()
g2=ggplot(datos,aes(x=Años_Experiencia))+geom_histogram()+theme_bw()
g2_2=ggplot(datos,aes(x=Años_Experiencia))+geom_boxplot()+theme_bw()
g3=ggplot(datos,aes(x=Distancia_Casa))+geom_histogram()+theme_bw()
g3_3=ggplot(datos,aes(x=Distancia_Casa))+geom_boxplot()+theme_bw()
ggarrange(g1,g1_1, g2,g2_2,g3,g3_3,ncol = 2, nrow = 3)


```

Los estadisticos básicos de las variables y las distribuciones mostradas gráficamente permiten evidenciar los siguientes rasgos generales del grupo de trabajadores analizado: 

- En promedio la empresa no maneja una población de trabajadores muy joven, el promedio y la mediana rondan los 36 años que dan muestra de un perfil mucho más adulto.

- La experiencia del primer cuartil y de la mediana evidencian que la proporcion de trabajadores con poca experiencia (menor a 3 años) no es dominante y que porlo menos el 75% de los trabajadores tienen más de 6 años de experiencia.  

-  lo que respecta a distancia del lugar de trabajo por lo menos un 50% vive a 7 o menos kilometros del lugar de trabajo, el 50% restante cuenta con una variedad relevante de distancias.


### 2.2 Análisis bivariado de variables cuantitativas

Para el abordaje de este analisis se tomarán en consideración los estadísticos basicos relacionados para los casos en los que se presenta y no se presenta rotación y a partir de esto se generarán los respectivos histogramas y diagramas de caja relacionados a cada grupo con el fin de conocer como están distribuidos y apreciar si existen diferencias en sus medidas de tendencia central que permitan caracterizar de forma más precisa a los individuos que rotan.  

 
#### Edad vs  Rotación
```{r}
summary_1<- datos_grupo %>%
    select(Rotación,Edad) %>%
    group_by(Rotación) %>% 
    summarize(min = min(Edad),
            q1 = quantile(Edad, 0.25),
            median = median(Edad),
            mean = mean(Edad),
            q3 = quantile(Edad, 0.75),
            max = max(Edad))

summary_1

```

```{r message=FALSE, warning=FALSE}
boxplot(datos_grupo$Edad~datos_grupo$Rotación,col="red")
ggplot(datos_grupo,aes(x=Edad))+geom_histogram()+facet_grid(~Rotación)+theme_bw()
```



#### Años Experiencia vs Rotación
```{r}
summary_2<- datos_grupo %>%
    select(Rotación,Años_Experiencia) %>%
    group_by(Rotación) %>% 
    summarize(min = min(Años_Experiencia),
            q1 = quantile(Años_Experiencia, 0.25),
            median = median(Años_Experiencia),
            mean = mean(Años_Experiencia),
            q3 = quantile(Años_Experiencia, 0.75),
            max = max(Años_Experiencia))

summary_2

```

```{r}
boxplot(datos$Años_Experiencia~datos$Rotación,col="red")
ggplot(datos_grupo,aes(x=Años_Experiencia))+geom_histogram()+facet_grid(~Rotación)+theme_bw()

```


#### Distancia_Casa vs Rotación

```{r}
summary_3<- datos_grupo %>%
    select(Rotación,Distancia_Casa) %>%
    group_by(Rotación) %>% 
    summarize(min = min(Distancia_Casa),
            q1 = quantile(Distancia_Casa, 0.25),
            median = median(Distancia_Casa),
            mean = mean(Distancia_Casa),
            q3 = quantile(Distancia_Casa, 0.75),
            max = max(Distancia_Casa))

summary_3

```

```{r}

bx_distcasrot<-boxplot(datos$Distancia_Casa~datos$Rotación,col="red")

ggplot(datos_grupo,aes(x=Distancia_Casa))+geom_histogram()+facet_grid(~Rotación)+theme_bw()
           



```


De acuerdo a los resultados se puede apreciar que el rango de edades entre 26 y 35 años es donde se presenta mayor rotación, también podemos ver que hay un nivel de rotación muy alto en personas con al menos 1 año de experiencia, esto respalda la hipótesis de que son las personas jóvenes con menos experiencia las que más rotan, por último la variable de distancia de la vivienda nos muestra que vivir lejos no es motivo para que se presente mayor rotación. 







## 3. Analisis variables cualitativas

### 3.1 Análisis Univarido

```{r include=FALSE}
rotacion_freq<-datos_grupo %>%
    group_by(Rotación) %>%
    summarise(FrecAbs=n())
rotacion_freq<-rotacion_freq %>%
    mutate(FrecRelativa=FrecAbs/sum(FrecAbs))

rotacion_freq.t<- ggtexttable(rotacion_freq,rows=NULL,
                              theme = ttheme("mOrange"))


# Tabla de frecuencia variable Horas_Extra
horasext_freq<-datos_grupo %>%
    group_by(Horas_Extra) %>%
    summarise(FrecAbs=n())
horasext_freq<-horasext_freq %>%
    mutate(FrecRelativa=FrecAbs/sum(FrecAbs))

# Tabla de frecuencias formateada

horasext_freq.t<- ggtexttable(horasext_freq,rows=NULL,
                              theme = ttheme("mOrange"))


# Tabla de frecuencia variable Satisfacción_Ambiental
satisfamb_freq<-datos_grupo %>%
    group_by(Satisfacción_Ambiental) %>%
    summarise(FrecAbs=n())
satisfamb_freq<-satisfamb_freq %>%
    mutate(FrecRelativa=FrecAbs/sum(FrecAbs))

# Tabla de frecuencias formateada

satisfamb_freq.t<- ggtexttable(satisfamb_freq,rows=NULL,
                              theme = ttheme("mOrange"))



# Tabla de frecuencia variable Cargo
Cargo_freq<-datos_grupo %>%
    group_by(Cargo) %>%
    summarise(FrecAbs=n())
Cargo_freq<-Cargo_freq %>%
    mutate(FrecRelativa=FrecAbs/sum(FrecAbs))
Cargo_freq<-Cargo_freq %>%
    arrange(desc(FrecAbs))


# Tabla de frecuencias formateada

Cargo_freq.t<- ggtexttable(Cargo_freq,rows=NULL,
                               theme = ttheme("mOrange"))


ggarrange(rotacion_freq.t,horasext_freq.t,satisfamb_freq.t,ncol=1,nrow=3,align = "hv")


```



```{r}

ggarrange(Cargo_freq.t,ncol=1,nrow=1)

```
```{r echo=FALSE, message=FALSE, warning=FALSE}

bart_rot<- ggplot(data=datos_grupo,aes(as.factor(datos_grupo$Rotación)))+
    geom_bar(color="black",fill="orange",alpha=0.7)+
    ggtitle("Distribución de rotación")+
    theme(
        plot.title=element_text(family =" ",face="bold",colour="black",size=13,
                                hjust=0.5,vjust=0.5)
    )+xlab("Rotación")+ylab("Conteo")


bart_horasext<- ggplot(data=datos_grupo,aes(as.factor(datos_grupo$Horas_Extra)))+
    geom_bar(color="black",fill="orange",alpha=0.7)+
    ggtitle("Distribución de funcionarios con horas extra")+
    theme(
        plot.title=element_text(family =" ",face="bold",colour="black",size=13,
                                hjust=0.5,vjust=0.5)
    )+xlab("¿Labora horas extra?")+ylab("Conteo")


bart_satisfamb<- ggplot(data=datos_grupo,aes(as.factor(datos_grupo$Satisfacción_Ambiental)))+
    geom_bar(color="black",fill="orange",alpha=0.7)+
    ggtitle("Distribución nivel de satisfacción ambiente laboral")+
    theme(
        plot.title=element_text(family =" ",face="bold",colour="black",size=13,
                                hjust=0.5,vjust=0.5)
    )+xlab("¿Qué tan satisfecho esta con el ambiente laboral?")+ylab("Conteo")


bart_cargo<- ggplot(data=Cargo_freq,aes(x=Cargo,y=FrecAbs))+
    geom_bar(stat="identity",color="black",fill="orange",alpha=0.7)+
    ggtitle("Distribución de cargos")+
    theme(
        plot.title=element_text(family =" ",face="bold",colour="black",size=13,
                                hjust=0.5,vjust=0.5)
    )+xlab("Cargos")+ylab("Conteo")+coord_flip()


ggarrange(bart_rot,bart_horasext,bart_satisfamb,bart_cargo,ncol=2,nrow=2)




```


### 3.2 Análisis bivarido

```{r include=FALSE}

agrup1_herot<- datos_grupo %>% 
    group_by(Horas_Extra,Rotación) %>%
    summarise(FrecAbs=n()) %>% 
    mutate(FrecRelativa=FrecAbs/sum(FrecAbs)) %>%
    arrange(desc(FrecAbs))
    
    
agrup2_satisfamb<- datos_grupo %>% 
    group_by(Satisfacción_Ambiental,Rotación) %>%
    summarise(FrecAbs=n()) %>% 
    mutate(FrecRelativa=FrecAbs/sum(FrecAbs)) %>%
    arrange(desc(FrecAbs))

agrup3_cargo<- datos_grupo %>% 
    group_by(Cargo,Rotación) %>% 
    summarise(FrecAbs=n()) %>% 
    mutate(FrecRelativa=FrecAbs/sum(FrecAbs)) %>%
    arrange(desc(FrecAbs))


## Rotación vs horas extras

barplot_rothe<-ggplot(agrup1_herot,aes(fill=Rotación,y=FrecAbs,x=Horas_Extra))+
    geom_bar(position="stack",stat="identity")

barplot_rothe_rel<-ggplot(agrup1_herot,aes(fill=Rotación,y=FrecAbs,x=Horas_Extra))+
    geom_bar(position="fill",stat="identity")

## Rotación vs Satisfacción Ambiental

barplot_rotsatisf<- ggplot(agrup2_satisfamb,aes(fill=Rotación,y=FrecAbs,x=Satisfacción_Ambiental))+
    geom_bar(position="stack",stat="identity")

barplot_rotsatisf_rel<- ggplot(agrup2_satisfamb,aes(fill=Rotación,y=FrecAbs,x=Satisfacción_Ambiental))+
    geom_bar(position="fill",stat="identity")


## Rotación vs Cargo

barplot_rotcargo<- ggplot(agrup3_cargo,aes(fill=Rotación,y=FrecAbs,x=Cargo))+
    geom_bar(position="stack",stat="identity") +coord_flip()

barplot_rotcargo_rel<- ggplot(agrup3_cargo,aes(fill=Rotación,y=FrecAbs,x=Cargo))+
    geom_bar(position="fill",stat="identity") +coord_flip()



```




```{r}

ggarrange(barplot_rothe,barplot_rothe_rel,ncol=2,nrow=1)

```





```{r}

ggarrange(barplot_rotsatisf,barplot_rotsatisf_rel,ncol=2,nrow=1)

```






```{r}

ggarrange(barplot_rotcargo,barplot_rotcargo_rel,ncol=2,nrow=1)

```







## 4.Conclusiones

-	Podemos afirmar que las personas jóvenes con poca experiencia laboral generarán mayor rotación, se recomienda contratar a personas con más de 11 años de experiencia.

-	Se recomienda no prestar atención a la variable distancia de la vivienda ya que no resulta ser trascendental en la rotación.


-	Mediante un análisis bivariado es posible cruzar variables que aparecen relacionadas dentro de la misma muestra, de esta forma se encuentran respuestas a hipótesis planteadas inicialmente.

     






